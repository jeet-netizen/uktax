<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Tax & Dividend Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-gray-50 text-slate-900 min-h-screen">

    <div class="max-w-6xl mx-auto p-4 md:p-8">
        <!-- Header -->
        <header class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8">
            <div>
                <h1 class="text-3xl font-extrabold flex items-center gap-3 text-slate-800">
                    <div class="p-2 bg-indigo-600 rounded-lg text-white">
                        <i data-lucide="calculator"></i>
                    </div>
                    UK Tax Dashboard
                </h1>
                <p class="text-slate-500 mt-1">Salary & Dividend Liability Calculator</p>
            </div>
            
            <div class="flex bg-white p-1 rounded-xl border border-slate-200 shadow-sm overflow-hidden" id="year-toggle">
                <button onclick="setYear('2024/25')" id="btn-2024" class="px-6 py-2 rounded-lg text-sm font-bold transition-all bg-indigo-600 text-white shadow-md">2024/25</button>
                <button onclick="setYear('2025/26')" id="btn-2025" class="px-6 py-2 rounded-lg text-sm font-bold transition-all text-slate-500 hover:bg-gray-50">2025/26</button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Left Column: Inputs -->
            <div class="lg:col-span-4 space-y-6">
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                    <h2 class="text-lg font-bold mb-6 flex items-center gap-2">
                        <i data-lucide="wallet" class="text-indigo-500 w-5 h-5"></i>
                        Annual Income
                    </h2>
                    
                    <div class="space-y-5">
                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-wider">Gross Salary</label>
                            <div class="relative group">
                                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold">£</span>
                                <input type="number" id="salary-input" value="55000" oninput="updateDashboard()"
                                    class="w-full pl-9 pr-4 py-4 bg-slate-50 border-2 border-transparent focus:border-indigo-500 focus:bg-white rounded-xl outline-none transition-all font-bold text-lg">
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-wider">Gross Dividends</label>
                            <div class="relative group">
                                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold">£</span>
                                <input type="number" id="dividend-input" value="10000" oninput="updateDashboard()"
                                    class="w-full pl-9 pr-4 py-4 bg-slate-50 border-2 border-transparent focus:border-indigo-500 focus:bg-white rounded-xl outline-none transition-all font-bold text-lg">
                            </div>
                        </div>
                    </div>

                    <div id="taper-alert" class="mt-6 p-4 bg-amber-50 rounded-xl border border-amber-100 flex gap-3 hidden">
                        <i data-lucide="info" class="text-amber-600 shrink-0 w-5 h-5"></i>
                        <p class="text-xs text-amber-800 leading-relaxed">
                            <span class="font-bold">Allowance Taper:</span> Your income exceeds £100k. Your Personal Allowance has been reduced.
                        </p>
                    </div>
                </div>

                <div class="bg-indigo-700 p-6 rounded-2xl text-white shadow-xl shadow-indigo-100">
                    <p class="text-indigo-200 text-xs font-bold uppercase tracking-widest mb-1">Take Home Pay</p>
                    <h3 class="text-4xl font-black mb-1" id="net-pay-display">£0.00</h3>
                    <div class="flex items-center gap-2 text-indigo-200 text-sm">
                        <i data-lucide="arrow-down-circle" class="w-4 h-4"></i>
                        <span id="monthly-pay-display">≈ £0.00 per month</span>
                    </div>
                </div>
            </div>

            <!-- Right Column: Results -->
            <div class="lg:col-span-8 space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Chart -->
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm flex flex-col items-center">
                        <h3 class="text-sm font-bold text-slate-400 flex items-center gap-2 self-start mb-4 uppercase tracking-wider">
                            <i data-lucide="pie-chart" class="w-4 h-4"></i> Income Split
                        </h3>
                        <div class="h-[240px] w-full flex items-center justify-center">
                            <canvas id="incomeChart"></canvas>
                        </div>
                    </div>

                    <!-- Summary -->
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm flex flex-col">
                        <h3 class="text-sm font-bold text-slate-400 flex items-center gap-2 mb-6 uppercase tracking-wider">
                            <i data-lucide="trending-up" class="w-4 h-4"></i> Summary
                        </h3>
                        <div class="space-y-4 flex-grow flex flex-col justify-center">
                            <div class="flex justify-between items-center py-2 border-b border-slate-50">
                                <span class="text-sm text-slate-500">Total Gross</span>
                                <span class="font-bold text-slate-800" id="summary-gross">£0.00</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b border-slate-50">
                                <span class="text-sm text-slate-500">Salary Tax</span>
                                <span class="font-bold text-blue-600" id="summary-salary-tax">-£0.00</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b border-slate-50">
                                <span class="text-sm text-slate-500">Dividend Tax</span>
                                <span class="font-bold text-amber-600" id="summary-div-tax">-£0.00</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-b border-slate-50">
                                <span class="text-sm text-slate-500">Nat. Insurance</span>
                                <span class="font-bold text-rose-500" id="summary-ni">-£0.00</span>
                            </div>
                            <div class="mt-4 p-4 bg-emerald-50 rounded-xl flex justify-between items-center">
                                <span class="text-sm font-bold text-emerald-800">Final Net</span>
                                <span class="text-2xl font-black text-emerald-600" id="summary-net">£0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Breakdown -->
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                    <h3 class="text-sm font-bold text-slate-400 mb-6 flex items-center gap-2 uppercase tracking-wider">
                        <i data-lucide="hash" class="w-4 h-4"></i> Detailed Breakdown
                    </h3>
                    
                    <div class="space-y-6">
                        <div>
                            <p class="text-xs font-bold text-slate-400 mb-3 uppercase">Salary Bands</p>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="salary-band-container">
                                <!-- JS injected -->
                            </div>
                        </div>
                        <div>
                            <p class="text-xs font-bold text-slate-400 mb-3 uppercase">Dividend Bands</p>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="dividend-band-container">
                                <!-- JS injected -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-900 rounded-2xl p-6 text-white relative overflow-hidden shadow-xl">
                    <h3 class="text-lg font-bold mb-3">HMRC Stacking Rule</h3>
                    <p class="text-sm text-slate-400 leading-relaxed max-w-lg">
                        In the UK, dividends are taxed as the "top slice" of your income. They are added on top of your salary, which is why dividends often fall into higher tax brackets even if the dividend amount itself is small.
                    </p>
                </div>
            </div>
        </div>
        
        <footer class="mt-12 py-8 border-t border-slate-200 text-center text-slate-400 text-xs">
            <p>© <span id="current-year"></span> UK Tax Dashboard • Based on standard 1257L tax code</p>
        </footer>
    </div>

    <script>
        // --- State ---
        let currentTaxYear = '2024/25';
        let incomeChart = null;

        const CONFIG = {
            '2024/25': {
                personalAllowance: 12570,
                taperThreshold: 100000,
                basicRateMax: 50270,
                higherRateMax: 125140,
                dividendAllowance: 500,
                niPrimaryThreshold: 12570,
                niUpperLimit: 50270,
                niRates: { basic: 0.08, upper: 0.02 }
            },
            '2025/26': {
                personalAllowance: 12570,
                taperThreshold: 100000,
                basicRateMax: 50270,
                higherRateMax: 125140,
                dividendAllowance: 500,
                niPrimaryThreshold: 12570,
                niUpperLimit: 50270,
                niRates: { basic: 0.08, upper: 0.02 }
            }
        };

        function fmt(v) {
            return new Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP' }).format(v);
        }

        function setYear(year) {
            currentTaxYear = year;
            const btn24 = document.getElementById('btn-2024');
            const btn25 = document.getElementById('btn-2025');
            
            if (year === '2024/25') {
                btn24.className = "px-6 py-2 rounded-lg text-sm font-bold bg-indigo-600 text-white shadow-md";
                btn25.className = "px-6 py-2 rounded-lg text-sm font-bold text-slate-500 hover:bg-gray-50";
            } else {
                btn24.className = "px-6 py-2 rounded-lg text-sm font-bold text-slate-500 hover:bg-gray-50";
                btn25.className = "px-6 py-2 rounded-lg text-sm font-bold bg-indigo-600 text-white shadow-md";
            }
            updateDashboard();
        }

        function updateDashboard() {
            const salary = parseFloat(document.getElementById('salary-input').value) || 0;
            const dividends = parseFloat(document.getElementById('dividend-input').value) || 0;
            const cfg = CONFIG[currentTaxYear];
            const totalIncome = salary + dividends;

            // 1. PA Taper
            let adjustedPA = cfg.personalAllowance;
            if (totalIncome > cfg.taperThreshold) {
                const reduction = Math.floor((totalIncome - cfg.taperThreshold) / 2);
                adjustedPA = Math.max(0, cfg.personalAllowance - reduction);
            }
            document.getElementById('taper-alert').classList.toggle('hidden', adjustedPA >= cfg.personalAllowance);

            // 2. Salary Tax
            let remSalary = salary;
            let salTax = 0;
            const salBands = [];

            const paUsed = Math.min(salary, adjustedPA);
            salBands.push({ label: 'Allowance', amount: paUsed, tax: 0 });
            remSalary -= paUsed;

            const basicSize = Math.max(0, cfg.basicRateMax - adjustedPA);
            const inBasic = Math.min(remSalary, basicSize);
            if (inBasic > 0) {
                const t = inBasic * 0.20;
                salBands.push({ label: 'Basic (20%)', amount: inBasic, tax: t });
                salTax += t;
                remSalary -= inBasic;
            }

            const higherSize = cfg.higherRateMax - cfg.basicRateMax;
            const inHigher = Math.min(remSalary, higherSize);
            if (inHigher > 0) {
                const t = inHigher * 0.40;
                salBands.push({ label: 'Higher (40%)', amount: inHigher, tax: t });
                salTax += t;
                remSalary -= inHigher;
            }

            if (remSalary > 0) {
                const t = remSalary * 0.45;
                salBands.push({ label: 'Add. (45%)', amount: remSalary, tax: t });
                salTax += t;
            }

            // 3. NI
            let ni = 0;
            if (salary > cfg.niPrimaryThreshold) {
                const bNi = Math.min(salary, cfg.niUpperLimit) - cfg.niPrimaryThreshold;
                ni += bNi * cfg.niRates.basic;
                if (salary > cfg.niUpperLimit) ni += (salary - cfg.niUpperLimit) * cfg.niRates.upper;
            }

            // 4. Dividend Tax
            let remPA = Math.max(0, adjustedPA - salary);
            let remDivs = dividends;
            let divTax = 0;
            const divBands = [];

            const divInPA = Math.min(remDivs, remPA);
            if (divInPA > 0) {
                divBands.push({ label: 'Allowance (PA)', amount: divInPA, tax: 0 });
                remDivs -= divInPA;
            }

            const divAllUsed = Math.min(remDivs, cfg.dividendAllowance);
            if (divAllUsed > 0) {
                divBands.push({ label: 'Div. Allowance', amount: divAllUsed, tax: 0 });
                remDivs -= divAllUsed;
            }

            if (remDivs > 0) {
                let pos = salary + (dividends - remDivs);
                if (pos < cfg.basicRateMax) {
                    const space = cfg.basicRateMax - pos;
                    const amt = Math.min(remDivs, space);
                    const t = amt * 0.0875;
                    divBands.push({ label: 'Basic (8.75%)', amount: amt, tax: t });
                    divTax += t;
                    remDivs -= amt;
                    pos += amt;
                }
                if (remDivs > 0 && pos < cfg.higherRateMax) {
                    const space = cfg.higherRateMax - pos;
                    const amt = Math.min(remDivs, space);
                    const t = amt * 0.3375;
                    divBands.push({ label: 'Higher (33.75%)', amount: amt, tax: t });
                    divTax += t;
                    remDivs -= amt;
                    pos += amt;
                }
                if (remDivs > 0) {
                    const t = remDivs * 0.3935;
                    divBands.push({ label: 'Add. (39.35%)', amount: remDivs, tax: t });
                    divTax += t;
                }
            }

            const totalTax = salTax + divTax + ni;
            const net = totalIncome - totalTax;

            // UI Update
            document.getElementById('net-pay-display').textContent = fmt(net);
            document.getElementById('monthly-pay-display').textContent = `≈ ${fmt(net/12)} per month`;
            document.getElementById('summary-gross').textContent = fmt(totalIncome);
            document.getElementById('summary-salary-tax').textContent = `-${fmt(salTax)}`;
            document.getElementById('summary-div-tax').textContent = `-${fmt(divTax)}`;
            document.getElementById('summary-ni').textContent = `-${fmt(ni)}`;
            document.getElementById('summary-net').textContent = fmt(net);

            // Render Bands
            const salContainer = document.getElementById('salary-band-container');
            salContainer.innerHTML = salBands.map(b => `
                <div class="bg-blue-50/50 border border-blue-100 p-3 rounded-xl">
                    <p class="text-[10px] font-bold text-blue-400 uppercase truncate">${b.label}</p>
                    <p class="text-lg font-black text-blue-800">${fmt(b.tax)}</p>
                    <p class="text-[10px] text-blue-500 mt-1">on ${fmt(b.amount)}</p>
                </div>
            `).join('') + `
                <div class="bg-rose-50 border border-rose-100 p-3 rounded-xl">
                    <p class="text-[10px] font-bold text-rose-400 uppercase">Nat. Insurance</p>
                    <p class="text-lg font-black text-rose-800">${fmt(ni)}</p>
                </div>
            `;

            const divContainer = document.getElementById('dividend-band-container');
            divContainer.innerHTML = divBands.map(b => `
                <div class="bg-amber-50 border border-amber-100 p-3 rounded-xl">
                    <p class="text-[10px] font-bold text-amber-500 uppercase truncate">${b.label}</p>
                    <p class="text-lg font-black text-amber-900">${fmt(b.tax)}</p>
                    <p class="text-[10px] text-amber-600 mt-1">on ${fmt(b.amount)}</p>
                </div>
            `).join('') || '<p class="text-xs text-slate-400 italic">No dividends entered</p>';

            updateChart(net, salTax, divTax, ni);
        }

        function updateChart(net, salTax, divTax, ni) {
            const data = [net, salTax, divTax, ni];
            const labels = ['Net Pay', 'Salary Tax', 'Div Tax', 'NI'];
            const colors = ['#10b981', '#3b82f6', '#f59e0b', '#ef4444'];

            if (!incomeChart) {
                const ctx = document.getElementById('incomeChart').getContext('2d');
                incomeChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{ data: data, backgroundColor: colors, borderWidth: 0 }]
                    },
                    options: {
                        cutout: '65%',
                        plugins: { legend: { display: false } }
                    }
                });
            } else {
                incomeChart.data.datasets[0].data = data;
                incomeChart.update();
            }
        }

        // Init
        document.getElementById('current-year').textContent = new Date().getFullYear();
        window.onload = () => {
            lucide.createIcons();
            updateDashboard();
        };
    </script>
</body>
</html>
